<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Happy Coder | Quiz Result</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            margin: 0;
            font-family: 'Roboto', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #1f1c2c, #928dab);
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            padding-top: 80px;
            overflow: hidden;
        }

        .header-logo {
            position: fixed;
            top: 20px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }
        .header-logo img {
            width: 50px;
            height: 50px;
            border-radius: 10px;
        }
        .header-logo span {
            font-size: 24px;
            font-weight: 700;
            color: #f3c623;
        }

        .result-card {
            max-width: 700px;
            min-width: 500px;
            padding: 50px 40px;
            border-radius: 15px;
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 1;
            position: relative;
        }

        .result-card h3 { color: #f3c623; margin-bottom: 20px; }
        .result-card p { font-size: 16px; color: #ddd; margin: 8px 0; }
        #message { font-size: 20px; font-weight: 700; margin-top: 15px; color: #f3c623; }

        .btn-primary {
            background: linear-gradient(90deg, #f3c623, #f5576c);
            border: none;
            font-weight: bold;
            color: #1f1c2c;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(243,198,35,0.5);
        }

        hr { border-color: rgba(255,255,255,0.2); }
        canvas#fireworksCanvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        #detailedResult p { margin: 3px 0; }
        #detailedResult div { border-left: 4px solid #f3c623; }
    </style>
</head>
<body>

<canvas id="fireworksCanvas"></canvas>

<div class="header-logo">
    <img src="happy-coder-logo.png" alt="Happy Coder Logo">
    <span>Happy Coder</span>
</div>

<div style="display: flex; gap: 20px; width: 100%; height: 90vh; padding: 20px; box-sizing: border-box;">

    <!-- LEFT: Result Card -->
    <div class="result-card" style="
        flex: 1;
        min-width: 300px;
        max-width: 400px;
        padding: 40px 30px;
        border-radius: 15px;
        background: rgba(255,255,255,0.05);
        backdrop-filter: blur(10px);
        box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        text-align: center;
    ">
        <h3>üéâ Quiz Result</h3>
        <hr style="border-color: rgba(255,255,255,0.2);">

        <p><strong>Name:</strong> <span id="name"></span></p>
        <p><strong>Correct Answers:</strong> <span id="correct"></span></p>
        <p><strong>Wrong Answers:</strong> <span id="wrong"></span></p>
        <p><strong>Percentage:</strong> <span id="percentage"></span>%</p>
        <p><strong>Time Taken:</strong> <span id="time"></span></p>

        <div id="message" style="font-size: 18px; font-weight: 700; margin-top: 10px; color: #f3c623;"></div>

        <button class="btn btn-primary mt-3" onclick="restartQuiz()" style="padding: 10px 25px; font-size: 16px;">Try Again</button>
    </div>

    <!-- RIGHT: Detailed Quiz -->
    <div id="detailedResult" style="
        flex: 2;
        max-height: 90vh;
        overflow-y: auto;
        padding: 20px;
        border-radius: 10px;
        background: rgba(255,255,255,0.05);
        backdrop-filter: blur(10px);
        box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    ">
        <!-- Dynamic question results will be appended here -->
    </div>

</div>



<script>
    const name = localStorage.getItem("quizUser") || "Guest";
    const correct = parseInt(localStorage.getItem("correct")) || 0;
    const wrong = parseInt(localStorage.getItem("wrong")) || 0;
    const percentage = parseFloat(localStorage.getItem("percentage")) || 0;
    const totalSeconds = parseInt(localStorage.getItem("timeTaken")) || 0;
    const minutes = Math.floor(totalSeconds / 60);
    const seconds = totalSeconds % 60;
    const selectedQuestions = JSON.parse(localStorage.getItem("selectedQuestions")) || [];
    const userAnswers = JSON.parse(localStorage.getItem("userAnswers")) || [];

    document.getElementById("name").innerText = name;
    document.getElementById("correct").innerText = correct;
    document.getElementById("wrong").innerText = wrong;
    document.getElementById("percentage").innerText = percentage.toFixed(2);
    document.getElementById("time").innerText = `${minutes}min ${seconds}sec`;

    const messageEl = document.getElementById("message");
    if(percentage >= 60){
        messageEl.innerText = "üéâ Congratulations! You passed!";
        startFireworks();
    } else {
        messageEl.innerText = "üí™ Better luck next time!";
    }

    function restartQuiz() {
        window.location.href = "index.html";
    }

    function startFireworks() {
        const canvas = document.getElementById("fireworksCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        let fireworks = [];

        function randomColor(){ return `hsl(${Math.random()*360},100%,50%)`; }
        class Particle {
            constructor(x,y,color){ this.x=x; this.y=y; this.color=color; this.vx=(Math.random()-0.5)*4; this.vy=(Math.random()-1.5)*4; this.alpha=1; this.life=60; }
            update(){ this.x+=this.vx; this.y+=this.vy; this.alpha-=0.02; this.life--; }
            draw(){ ctx.globalAlpha=this.alpha; ctx.fillStyle=this.color; ctx.beginPath(); ctx.arc(this.x,this.y,3,0,Math.PI*2); ctx.fill(); ctx.globalAlpha=1; }
        }

        function launchFirework(){
            const x=Math.random()*canvas.width;
            const y=Math.random()*canvas.height/2;
            const color=randomColor();
            for(let i=0;i<30;i++) fireworks.push(new Particle(x,y,color));
        }

        function animate(){
            ctx.fillStyle="rgba(31,28,44,0.2)";
            ctx.fillRect(0,0,canvas.width,canvas.height);
            for(let i=fireworks.length-1;i>=0;i--){
                fireworks[i].update();
                fireworks[i].draw();
                if(fireworks[i].life<=0) fireworks.splice(i,1);
            }
            if(Math.random()<0.05) launchFirework();
            requestAnimationFrame(animate);
        }

        animate();
    }

    const detailedContainer = document.getElementById("detailedResult");

    selectedQuestions.forEach((q, i) => {
        const userAnswerIndex = userAnswers[i];
        const correctIndex = q.correct;
        const isCorrect = userAnswerIndex === correctIndex;

        // Question Div
        const questionDiv = document.createElement("div");
        questionDiv.className = "mb-4 p-3 rounded";
        questionDiv.style.backgroundColor = "rgba(255,255,255,0.05)";
        questionDiv.style.borderLeft = "4px solid #f3c623";

        // Question Text
        const qText = document.createElement("p");
        qText.innerHTML = `<strong>Q${i + 1}:</strong> ${q.question}`;
        questionDiv.appendChild(qText);

        // Options List
        q.options.forEach((opt, idx) => {
            const optDiv = document.createElement("div");
            optDiv.style.display = "flex";
            optDiv.style.alignItems = "center";
            optDiv.style.gap = "10px";
            optDiv.style.margin = "5px 0";
            optDiv.style.padding = "3px";

            const tick = document.createElement("span");

            if (idx === userAnswerIndex && idx === correctIndex) {
                tick.innerText = "‚úÖ"; // Correct selected
            } else if (idx === userAnswerIndex && idx !== correctIndex) {
                tick.innerText = "‚ùå"; // Wrong selected
            } else if (idx === correctIndex) {
                tick.innerText = "‚úîÔ∏è"; // Correct answer
            } else {
                tick.innerText = ""; // No mark
            }

            

            const optText = document.createElement("span");
            optText.innerText = opt;

            // Styling
            if (idx === correctIndex) {
                optText.style.color = "#198754"; // Green for correct option
                optText.style.fontWeight = "600";
            } else if (idx === userAnswerIndex && !isCorrect) {
                optText.style.color = "#f5576c"; // Red for wrong selection
                optText.style.fontWeight = "600";
            }

            optDiv.appendChild(optText);
            questionDiv.appendChild(optDiv);
            optDiv.appendChild(tick);
        });

        // Message
        const msg = document.createElement("p");
        msg.style.fontWeight = "700";
        msg.style.marginTop = "5px";
        msg.innerText = isCorrect ? "‚úÖ Correct Answer" : "‚ùå Wrong Answer";
        msg.style.color = isCorrect ? "#198754" : "#f5576c";
        questionDiv.appendChild(msg);

        detailedContainer.appendChild(questionDiv);
    });

</script>

</body>
</html>

